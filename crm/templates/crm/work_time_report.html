{% extends 'crm/base.html' %}
{% load i18n %}

{% block title %}{% trans "–û—Ç—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã" %}{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="mb-4">
        <h1>üìä {% trans "–û—Ç—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã" %}</h1>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-4">
                    <label for="dateFilter" class="form-label">{% trans "–í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É" %}</label>
                    <input type="date" class="form-control" id="dateFilter" name="date" value="{{ filter_date|date:'Y-m-d' }}">
                </div>
                <div class="col-md-4 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary">{% trans "–§–∏–ª—å—Ç—Ä" %}</button>
                    <a href="{% url 'work_time_report' %}" class="btn btn-secondary ms-2">{% trans "–°–±—Ä–æ—Å–∏—Ç—å" %}</a>
                </div>
            </form>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ –∏ –∏—Ö –≤—Ä–µ–º–µ–Ω–∏ -->
    {% if work_logs %}
    <div class="table-responsive">
        <table class="table table-hover table-striped">
            <thead class="table-dark">
                <tr>
                    <th>{% trans "–°–æ—Ç—Ä—É–¥–Ω–∏–∫" %}</th>
                    <th>{% trans "–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞" %}</th>
                    <th>{% trans "–í—Ä–µ–º—è –∫–æ–Ω—Ü–∞" %}</th>
                    <th>{% trans "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å" %}</th>
                    <th>{% trans "–°—Ç–∞—Ç—É—Å" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for log in work_logs %}
                <tr>
                    <td>
                        <a href="{% url 'employee_work_time' log.employee.pk %}">
                            <strong>{{ log.employee.first_name }} {{ log.employee.last_name }}</strong>
                        </a>
                    </td>
                    <td>{{ log.start_time|date:"H:i" }}</td>
                    <td>
                        {% if log.end_time %}
                            {{ log.end_time|date:"H:i" }}
                        {% else %}
                            <span class="badge bg-warning">{% trans "–í —Ä–∞–±–æ—Ç–µ" %}</span>
                        {% endif %}
                    </td>
                    <td>
                        {% widthratio log.duration.total_seconds 3600 1 %}h
                        {% widthratio log.duration.total_seconds 60 1 %}m
                    </td>
                    <td>
                        {% if log.is_active %}
                            <span class="badge bg-success">{% trans "–ê–∫—Ç–∏–≤–Ω–∞" %}</span>
                        {% else %}
                            <span class="badge bg-secondary">{% trans "–ó–∞–≤–µ—Ä—à–µ–Ω–∞" %}</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- –ò—Ç–æ–≥–∏ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º -->
    <div class="card mt-4">
        <div class="card-header bg-dark text-white">
            <h5>{% trans "–ò—Ç–æ–≥–æ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º" %}</h5>
        </div>
        <div class="card-body">
            <div class="row">
                {% for employee in employees %}
                    {% if employee.id in employee_work_time %}
                    <div class="col-md-6 mb-3">
                        <div class="alert alert-info">
                            <strong>{{ employee.first_name }} {{ employee.last_name }}</strong>
                            <br>
                            {% widthratio employee_work_time|get_item:employee.id.total_seconds 3600 1 %}h
                            {% widthratio employee_work_time|get_item:employee.id.total_seconds 60 1 %}m
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    {% else %}
    <div class="alert alert-info mt-4">
        {% trans "–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ —Ä–∞–±–æ—á–µ–º –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É" %}
    </div>
    {% endif %}

</div>

<style>
    .table-hover tbody tr:hover {
        background-color: #f5f5f5;
    }
</style>
{% endblock %}
